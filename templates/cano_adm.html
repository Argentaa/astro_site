{% extends "base.html" %}
{% block content %}
<style>
    .cano-imagem {
        width: 100%;
        height: auto;
        max-width: 400px;
    }
    .table th, .table td {
        text-align: center;
        vertical-align: middle;
    }
</style>

<!-- Page Header Start -->
<div class="container-fluid page-header py-5 mb-5 wow fadeIn" data-wow-delay="0.1s">
    <div class="container text-center py-5">
        <h1 class="display-4 text-white animated slideInDown mb-4">{{ cano[1] }}</h1>
    </div>
</div>
<!-- Page Header End -->

<!-- Cano Details Start -->
<div class="container-xxl py-5">
    <div class="container">
        <div class="row g-4 justify-content-center">
            <div class="col-lg-8 wow fadeInUp" data-wow-delay="0.1s">
                <div class="card">
                    <img class="card-img-top cano-imagem" src="{{ url_for('static', filename=cano[3]) }}" alt="{{ cano[1] }}">
                    <div class="card-body">
                        <h5 class="card-title">{{ cano[1] }}</h5>
                        <pre class="card-text" style="font-family: Arial, sans-serif; font-size: 16px; line-height: 1.5;">{{ cano[2] }}</pre>
                    </div>
                </div>
            </div>
        </div>

        <!-- Form para editar a tabela de Bitolas e Espessuras -->
        <form action="" method="POST">
            <div class="row g-4 justify-content-center mt-4">
                <div class="col-lg-8 wow fadeInUp" data-wow-delay="0.1s">
                    <div class="card">
                        <div class="card-body">
                            <h5 class="card-title">Bitolas e Espessuras</h5>
                            <table class="table table-bordered" id="bitolas-table">
                                <thead>
                                    <tr>
                                        <th>Bitola</th>
                                        <th colspan="10">Espessura em Milímetros</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    {% for caracteristicas in resultados %}
                                        <tr>
                                            <td>
                                                <input type="text" name="bitola_{{ caracteristicas['bitola'] }}" value="{{ caracteristicas['bitola'] }}" class="form-control" />
                                            </td>

                                            <!-- Container de espessuras -->
                                            <td colspan="10">
                                                <div id="espessuras-{{ loop.index }}" class="d-flex flex-wrap gap-2">
                                                    {% set espessuras = caracteristicas['espessuras'].split(', ') if caracteristicas['espessuras'] is string else caracteristicas['espessuras'] %}

                                                    {% for espessura in espessuras %}
                                                        <div class="d-flex align-items-center mb-2">
                                                            <input type="text" name="espessura_{{ caracteristicas['bitola'] }}[]" value="{{ espessura }}" class="form-control" style="width: 70px;" />
                                                            <button type="button" class="btn btn-danger btn-sm ms-2" onclick="removeEspessura(this)">
                                                                <i class="bi bi-trash"></i>
                                                            </button>
                                                        </div>
                                                    {% endfor %}
                                                </div>
                                                <button type="button" class="btn btn-success mt-2" onclick="addEspessura({{ loop.index }})">
                                                    <i class="bi bi-plus"></i>
                                                </button>
                                            </td>
                                        </tr>
                                    {% endfor %}
                                </tbody>
                            </table>
                            <!-- Botão para adicionar uma nova bitola -->
                            <button type="button" class="btn btn-primary mt-3" onclick="addBitola()">
                                <i class="bi bi-plus-circle"></i> Adicionar Bitola
                            </button>
                            <button type="submit" class="btn btn-success mt-3">Salvar Alterações</button>
                        </div>
                    </div>
                </div>
            </div>
        </form>
        <!-- Tabela de Bitolas e Espessuras End -->
    </div>
</div>
<!-- Cano Details End -->

<!-- Script para adicionar e remover inputs de espessura e bitola dinamicamente -->
<script>
    let bitolaIndex = {{ resultados|length + 1 }};  // Define o índice inicial

    function addEspessura(rowIndex) {
        const container = document.getElementById(`espessuras-${rowIndex}`);
        const newDiv = document.createElement("div");
        newDiv.className = "d-flex align-items-center mb-2";

        const newInput = document.createElement("input");
        newInput.type = "text";
        newInput.name = `espessura_nova_${rowIndex}[]`;
        newInput.className = "form-control";
        newInput.style.width = "70px";

        const removeButton = document.createElement("button");
        removeButton.type = "button";
        removeButton.className = "btn btn-danger btn-sm ms-2";
        removeButton.innerHTML = '<i class="bi bi-trash"></i>';
        removeButton.onclick = function() {
            container.removeChild(newDiv);
        };

        newDiv.appendChild(newInput);
        newDiv.appendChild(removeButton);
        container.appendChild(newDiv);
    }

    function removeEspessura(button) {
        button.parentNode.remove();
    }

    function addBitola() {
        const tableBody = document.querySelector("#bitolas-table tbody");
        const newRow = document.createElement("tr");

        // Coluna da nova bitola
        const bitolaCell = document.createElement("td");
        const bitolaInput = document.createElement("input");
        bitolaInput.type = "text";
        bitolaInput.name = `bitola_nova_${bitolaIndex}`;
        bitolaInput.className = "form-control";
        bitolaCell.appendChild(bitolaInput);
        newRow.appendChild(bitolaCell);

        // Coluna das espessuras
        const espessurasCell = document.createElement("td");
        espessurasCell.colSpan = 10;
        espessurasCell.innerHTML = `
            <div id="espessuras-${bitolaIndex}" class="d-flex flex-wrap gap-2"></div>
            <button type="button" class="btn btn-success mt-2" onclick="addEspessura(${bitolaIndex})">
                <i class="bi bi-plus"></i>
            </button>
        `;

        newRow.appendChild(espessurasCell);
        tableBody.appendChild(newRow);
        bitolaIndex++;
    }
</script>
{% endblock %}
